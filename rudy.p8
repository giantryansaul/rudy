pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
--project rudy
--by nick jackson, ryan saul, anne strickland and david tran
--game title
function _init()
 title_screen()
 -- game_loop()
end

function title_screen()
 _update=title_update
 _draw=title_draw
 num_players=1
 max_players=2
end

function title_update()
 if btnp(2) then num_players-=1 end
 if btnp(3) then num_players+=1 end
 num_players=mid(1,num_players,max_players)
 if btnp(5) then game_loop() end
end

function title_draw()
 cls()
 print("project rudy",35,10,11)
 for i=1,max_players do
  print("players: "..i,40,10*i+30,9)
 end
 print(">",30,10*num_players+30,6)
end
-->8
--Game Loop and objects
function game_loop()
 players={}
 for i=1,num_players do
  add(players,create_player(i))
 end
 players[1].spr=16

 -- Find all destructible tiles
 dests={}
 for x=0,16 do
  for y=0,16 do
   spr=mget(x,y)
   if fget(spr,1) then add(dests,create_destruct(x,y,spr)) end
  end
 end

 _update=game_update
 _draw=game_draw
end

function create_player(i)
 cs={3,4,7,10,11,12}
 p={x=i*16,y=16,c=cs[i],spr=32,p=i}
 p.can_move=function(self,x,y)
   target=mget(flr((self.x)/8)+x,flr((self.y)/8)+y)

   return not fget(target,0)
 end
 p.can_left=function(self)
  u=mget(flr((self.x-1)/8),flr(self.y/8))
  l=mget(flr((self.x-1)/8),flr((self.y+7)/8))
  return (not fget(u,0) and not fget(l,0))
 end
 p.can_right=function(self)
  u=mget(flr((self.x+8)/8),flr(self.y/8))
  l=mget(flr((self.x+8)/8),flr((self.y+7)/8))
  return (not fget(u,0) and not fget(l,0))
 end
 p.can_up=function(self)
  u=mget(flr((self.x)/8),flr((self.y-1)/8))
  l=mget(flr((self.x+7)/8),flr((self.y-1)/8))
  return (not fget(u,0) and not fget(l,0))
 end
 p.can_down=function(self)
  u=mget(flr((self.x)/8),flr((self.y+8)/8))
  l=mget(flr((self.x+7)/8),flr((self.y+8)/8))
  return (not fget(u,0) and not fget(l,0))
 end
 p.interact=function(self)
  x=flr((self.x+4)/8)
  y=flr((self.y+4)/8)
  tile=mget(x,y)
  if fget(tile,1) then
   if self.p==1 then
    heal(tile)
   else
    hurt(tile)
   end
 end
 return p
end

function create_destruct(x,y,s)
 local d={t=tile,health=10.0,spr=s}
 return d
end
-->8
--Updates
function game_update()
 for i=1,#players do
  if btn(0,i-1) and players[i]:can_left() then players[i].x-=1 end --left
  if btn(1,i-1) and players[i]:can_right() then players[i].x+=1 end --right
  if btn(2,i-1) and players[i]:can_up() then players[i].y-=1 end --up
  if btn(3,i-1) and players[i]:can_down() then players[i].y+=1 end --down
 end
end

function heal(x,y)

end

function hurt(x,y)

end
-->8
--Draws
function game_draw()
 cls(0,0,0,0,20,20)
 map()
 for i=1,#players do
  p=players[i]
  pal(7,p.c)
  spr(p.spr,p.x,p.y)
  pal()
 end
end
-->8
--Utils
__gfx__
00000000177777710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007cccccc10440040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007007cccccc10440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770007cccccc10000044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770007cccccc10000044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007007cccccc10444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007cccccc10444004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000711111170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70700707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70700707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70077007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70700707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70700707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000020000000100020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000200010101000200010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
